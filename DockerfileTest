FROM rust:alpine

RUN apk add --update --no-cache musl-dev pkgconfig openssl-dev opus-dev ffmpeg youtube-dl

WORKDIR /usr/src/tsmusicbot
COPY . .

RUN --mount=type=cache,target=/usr/local/cargo/registry \
    --mount=type=cache,target=/usr/src/tsmusicbot/target \
    cargo install --path .

COPY ./config.json.default /opt/tsmusicbot/config.json

ENV RUST_LOG=TRACE
ENTRYPOINT ["/usr/local/cargo/bin/tsmusicbot"]